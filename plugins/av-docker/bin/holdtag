#! /bin/bash

# Import color
source $AV_CONFIG_DIR/default_imports

# Check for a help flag
avCheckHelpFlags "$1" "docker" "Enables remembering tag style for docker tag/push commands" "\n \
    Usage: holdtag [regular|one-repo|name-override|check]\n \
\n \
    regular         - Use format: <repo>/<domain>/<container>:<version>\n \
    one-repo       - Use format: <repo>/<domain>:<container>-<version>\n \
    name-override  - Use format: <repo>/<container>:<version>\n \
    check          - Display current setting\n \
\n"

#### Put system commands here

if [[ "$1" == "check" ]]; then
    tag_style=$(getpv holdtag)
    if [[ -z "$tag_style" ]]; then
        echo -e "Tag style is set to: ${bldgrn}regular${txtrst} (default)"
    else
        echo -e "Tag style is set to: ${bldgrn}${tag_style}${txtrst}"
    fi
    exit 0
fi

if [[ "$1" == "regular" ]]; then
    setpv "holdtag" "regular"
    echo -e "Tag style set to: ${bldgrn}regular${txtrst}"
    exit 0
fi

if [[ "$1" == "one-repo" ]]; then
    setpv "holdtag" "one-repo"
    echo -e "Tag style set to: ${bldgrn}one-repo${txtrst}"
    exit 0
fi

if [[ "$1" == "name-override" ]]; then
    setpv "holdtag" "name-override"
    echo -e "Tag style set to: ${bldgrn}name-override${txtrst}"
    exit 0
fi

# If no argument provided, show interactive menu
avAppendSystemPath
CHOICE=$(gum choose "regular" "one-repo" "name-override")
if [[ $? -eq 0 ]]; then
    setpv "holdtag" "$CHOICE"
    echo -e "Tag style set to: ${bldgrn}${CHOICE}${txtrst}"
    exit 0
fi

exit 1

#### End commands 