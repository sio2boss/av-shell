#! /bin/bash

# Import color
source $AV_CONFIG_DIR/default_imports

# Check for a help flag
avCheckHelpFlagsPassThrough "$1" "docker" "Run a command in a new container" "docker run --help"

# Import system path
avAppendSystemPath

#### Put system commands here

domain=$(cat $AV_CONFIG_DIR/prompt | sed "s/\ /\_/g")
if [ -z $domain ]; then
	echo -e "${txtred}Unable to understand prompt text as docker domain${txtrst}"
	exit
fi

container=$(getpv container)
if [ -z $domain ]; then
	echo -e "${txtred}Unable to understand prompt text as docker domain${txtrst}"
	exit
fi

container_path=$(container_path)
if [ -z $domain ]; then
	echo -e "${txtred}Unable to understand prompt text as docker domain${txtrst}"
	exit
fi

if [ ! -e "$container_path/Runfile" ]; then
	echo -e "${txtred}Unable to find Runfile in $container_path${txtrst}"
        exit
fi

line="docker run -d $(cat $container_path/Runfile) ${domain}/${container}"
echo  -e "runnning: $line "
cd ${container_path} && eval $line

holdhash=$(getpv holdhash)
if [[ "${holdhash}" == "true" ]]; then
	setpv "lasthash" "`docker ps -l -q`"
fi

#### End commands
